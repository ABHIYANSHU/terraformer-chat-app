<div class="chat-container">
  <div class="chat-header">
    <h2>Terraformer Chat</h2>
  </div>
  
  <div #chatContainer class="messages-container">
    <div *ngFor="let message of messages" 
         [ngClass]="{'message': true, 'user-message': message.sender === 'user', 'assistant-message': message.sender === 'assistant'}">
      <div class="message-avatar">
        <div class="avatar" [ngClass]="{'user-avatar': message.sender === 'user', 'assistant-avatar': message.sender === 'assistant'}">
          {{ message.sender === 'user' ? 'U' : 'A' }}
        </div>
      </div>
      <div class="message-content">
        <div class="message-header">
          <span class="sender-name">{{ message.sender === 'user' ? 'You' : 'Assistant' }}</span>
          <span class="timestamp">{{ message.timestamp | date:'short' }}</span>
        </div>
        <div class="message-body" [innerHTML]="formatMessage(message.content)"></div>
        
        <!-- File name display if present -->
        <div *ngIf="message.fileName" class="file-info">
          <span class="file-name">{{ message.fileName }}</span>
        </div>
      </div>
    </div>
    
    <!-- Loading indicator -->
    <div *ngIf="isLoading" class="message assistant-message loading-message">
      <div class="message-avatar">
        <div class="avatar assistant-avatar">A</div>
      </div>
      <div class="message-content">
        <div class="loading-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
  </div>
  
  <div class="input-container">
    <div class="file-upload">
      <label for="file-upload" class="file-upload-label">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/>
        </svg>
      </label>
      <input id="file-upload" type="file" (change)="onFileSelected($event)" />
    </div>
    
    <textarea 
      [(ngModel)]="newMessage" 
      placeholder="Type a message..." 
      (keydown)="handleKeyDown($event)"
    ></textarea>
    
    <button [disabled]="!newMessage.trim() || isLoading" (click)="sendMessage()">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/>
      </svg>
    </button>
  </div>
</div>